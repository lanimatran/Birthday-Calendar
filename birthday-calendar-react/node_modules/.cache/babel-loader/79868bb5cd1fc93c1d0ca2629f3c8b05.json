{"ast":null,"code":"import Axios from \"axios\";\nimport AccountService from \"./AccountService\";\nimport { LOCAL_STORAGE_AUTHENTICATION_TOKEN_KEY, SESSION_STORAGE_AUTHENTICATION_TOKEN_KEY } from '../Utility/GlobalConstants';\n\nclass ApiUtil {\n  createJwtToken(token) {\n    return 'Bearer ' + token;\n  }\n\n  setupInterceptors(token, handler) {\n    const requestInterceptor = this.setupRequestInterceptor(token);\n    this.setupResponseInterceptor(handler, requestInterceptor);\n  }\n\n  setupRequestInterceptor(token) {\n    let header = this.createJwtToken(token);\n    const interceptor = Axios.interceptors.request.use(config => {\n      config.headers.authorization = header;\n      return config;\n    });\n    return interceptor;\n  }\n\n  setupResponseInterceptor(handler, requestInterceptor) {\n    const interceptor = Axios.interceptors.response.use(response => response, error => {\n      console.log(\"Error has occured\");\n      console.log(error.response);\n      if (error.response.status !== 401) return Promise.reject(error);\n      console.log(\"Error was 401\");\n      Axios.interceptors.response.eject(interceptor);\n      Axios.interceptors.request.eject(requestInterceptor);\n      AccountService.refreshToken().then(response => {\n        console.log(\"I got to response\");\n        this.setupInterceptors(response.data.token);\n        if (localStorage.getItem(LOCAL_STORAGE_AUTHENTICATION_TOKEN_KEY)) localStorage.setItem(LOCAL_STORAGE_AUTHENTICATION_TOKEN_KEY, response.data.token);\n        sessionStorage.setItem(SESSION_STORAGE_AUTHENTICATION_TOKEN_KEY, response.data.token);\n      }).catch(error => {\n        sessionStorage.clear();\n        localStorage.clear();\n        console.log(requestInterceptor);\n        console.log(\"I got here to catch error in refresh API\");\n        handler();\n        return Promise.reject(error);\n      });\n    });\n    return interceptor;\n  }\n\n}\n\nexport default new ApiUtil();","map":{"version":3,"sources":["D:/Projects/Birthday Calendar/birthday-calendar-react/src/ApiServices/ApiUtil.js"],"names":["Axios","AccountService","LOCAL_STORAGE_AUTHENTICATION_TOKEN_KEY","SESSION_STORAGE_AUTHENTICATION_TOKEN_KEY","ApiUtil","createJwtToken","token","setupInterceptors","handler","requestInterceptor","setupRequestInterceptor","setupResponseInterceptor","header","interceptor","interceptors","request","use","config","headers","authorization","response","error","console","log","status","Promise","reject","eject","refreshToken","then","data","localStorage","getItem","setItem","sessionStorage","catch","clear"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,SAASC,sCAAT,EAAiDC,wCAAjD,QAAiG,4BAAjG;;AAEA,MAAMC,OAAN,CAAc;AACVC,EAAAA,cAAc,CAACC,KAAD,EAAQ;AAClB,WAAO,YAAYA,KAAnB;AACH;;AAEDC,EAAAA,iBAAiB,CAACD,KAAD,EAAQE,OAAR,EAAiB;AAC9B,UAAMC,kBAAkB,GAAG,KAAKC,uBAAL,CAA6BJ,KAA7B,CAA3B;AACA,SAAKK,wBAAL,CAA8BH,OAA9B,EAAuCC,kBAAvC;AACH;;AAEDC,EAAAA,uBAAuB,CAACJ,KAAD,EAAQ;AAC3B,QAAIM,MAAM,GAAG,KAAKP,cAAL,CAAoBC,KAApB,CAAb;AACA,UAAMO,WAAW,GAAGb,KAAK,CAACc,YAAN,CAAmBC,OAAnB,CAA2BC,GAA3B,CACfC,MAAD,IAAY;AACRA,MAAAA,MAAM,CAACC,OAAP,CAAeC,aAAf,GAA+BP,MAA/B;AACA,aAAOK,MAAP;AACH,KAJe,CAApB;AAMA,WAAOJ,WAAP;AACH;;AAEDF,EAAAA,wBAAwB,CAACH,OAAD,EAAUC,kBAAV,EAA8B;AAClD,UAAMI,WAAW,GAAGb,KAAK,CAACc,YAAN,CAAmBM,QAAnB,CAA4BJ,GAA5B,CAChBI,QAAQ,IAAIA,QADI,EAEhBC,KAAK,IACL;AACIC,MAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACD,QAAlB;AACA,UAAIC,KAAK,CAACD,QAAN,CAAeI,MAAf,KAA0B,GAA9B,EAAmC,OAAOC,OAAO,CAACC,MAAR,CAAeL,KAAf,CAAP;AACnCC,MAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACAvB,MAAAA,KAAK,CAACc,YAAN,CAAmBM,QAAnB,CAA4BO,KAA5B,CAAkCd,WAAlC;AACAb,MAAAA,KAAK,CAACc,YAAN,CAAmBC,OAAnB,CAA2BY,KAA3B,CAAiClB,kBAAjC;AAEAR,MAAAA,cAAc,CAAC2B,YAAf,GACCC,IADD,CAEIT,QAAQ,IAAI;AACRE,QAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACA,aAAKhB,iBAAL,CAAuBa,QAAQ,CAACU,IAAT,CAAcxB,KAArC;AACA,YAAIyB,YAAY,CAACC,OAAb,CAAqB9B,sCAArB,CAAJ,EAAmE6B,YAAY,CAACE,OAAb,CAAqB/B,sCAArB,EAA6DkB,QAAQ,CAACU,IAAT,CAAcxB,KAA3E;AACnE4B,QAAAA,cAAc,CAACD,OAAf,CAAuB9B,wCAAvB,EAAiEiB,QAAQ,CAACU,IAAT,CAAcxB,KAA/E;AACH,OAPL,EASC6B,KATD,CAUId,KAAK,IAAI;AACLa,QAAAA,cAAc,CAACE,KAAf;AACAL,QAAAA,YAAY,CAACK,KAAb;AACAd,QAAAA,OAAO,CAACC,GAAR,CAAYd,kBAAZ;AACAa,QAAAA,OAAO,CAACC,GAAR,CAAY,0CAAZ;AACAf,QAAAA,OAAO;AAEP,eAAOiB,OAAO,CAACC,MAAR,CAAeL,KAAf,CAAP;AACH,OAlBL;AAoBH,KA/Be,CAApB;AAiCA,WAAOR,WAAP;AACH;;AAxDS;;AA2Dd,eAAe,IAAIT,OAAJ,EAAf","sourcesContent":["import Axios from \"axios\"\r\nimport AccountService from \"./AccountService\"\r\nimport { LOCAL_STORAGE_AUTHENTICATION_TOKEN_KEY, SESSION_STORAGE_AUTHENTICATION_TOKEN_KEY } from '../Utility/GlobalConstants'\r\n\r\nclass ApiUtil {\r\n    createJwtToken(token) {\r\n        return 'Bearer ' + token\r\n    }\r\n\r\n    setupInterceptors(token, handler) {\r\n        const requestInterceptor = this.setupRequestInterceptor(token)\r\n        this.setupResponseInterceptor(handler, requestInterceptor)\r\n    } \r\n\r\n    setupRequestInterceptor(token) {\r\n        let header = this.createJwtToken(token)\r\n        const interceptor = Axios.interceptors.request.use(\r\n            (config) => {\r\n                config.headers.authorization = header\r\n                return config\r\n            }\r\n        )\r\n        return interceptor\r\n    }\r\n\r\n    setupResponseInterceptor(handler, requestInterceptor) {\r\n        const interceptor = Axios.interceptors.response.use(\r\n            response => response,\r\n            error =>\r\n            {\r\n                console.log(\"Error has occured\")\r\n                console.log(error.response)\r\n                if (error.response.status !== 401) return Promise.reject(error);\r\n                console.log(\"Error was 401\")\r\n                Axios.interceptors.response.eject(interceptor)\r\n                Axios.interceptors.request.eject(requestInterceptor)\r\n\r\n                AccountService.refreshToken()\r\n                .then(\r\n                    response => {\r\n                        console.log(\"I got to response\")\r\n                        this.setupInterceptors(response.data.token)\r\n                        if (localStorage.getItem(LOCAL_STORAGE_AUTHENTICATION_TOKEN_KEY))  localStorage.setItem(LOCAL_STORAGE_AUTHENTICATION_TOKEN_KEY, response.data.token)\r\n                        sessionStorage.setItem(SESSION_STORAGE_AUTHENTICATION_TOKEN_KEY, response.data.token)\r\n                    }\r\n                )\r\n                .catch(\r\n                    error => {\r\n                        sessionStorage.clear()\r\n                        localStorage.clear()\r\n                        console.log(requestInterceptor)\r\n                        console.log(\"I got here to catch error in refresh API\")\r\n                        handler()\r\n                        \r\n                        return Promise.reject(error);\r\n                    }\r\n                )\r\n            }\r\n        )\r\n        return interceptor\r\n    }\r\n}\r\n\r\nexport default new ApiUtil()"]},"metadata":{},"sourceType":"module"}